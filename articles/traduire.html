<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Translating with traduire • traduire</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Translating with traduire">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">traduire</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/traduire.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/reside-ic/traduire">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Translating with traduire</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/reside-ic/traduire/blob/master/vignettes/traduire.Rmd"><code>vignettes/traduire.Rmd</code></a></small>
      <div class="hidden name"><code>traduire.Rmd</code></div>

    </div>

    
    
<p>The <code>traduire</code> R package provides a wrapper around the <a href="https://i18next.com"><code>i18next</code> JavaScript library</a>. It presents an alternative interface to R’s built-in internationalisation functions, with a focus on the ability to change the target language within a session. Currently the package presents only a stripped down interface to the underlying library, though this may expand in future.</p>
<p>First, prepare a <code>json</code> file with your translations. For example, the included file <code>examples/simple.json</code> contains:</p>
<div class="sourceCode"><pre class="sourceCode json"><code class="sourceCode json"><span class="fu">{</span>
    <span class="dt">"en"</span><span class="fu">:</span> <span class="fu">{</span>
        <span class="dt">"translation"</span><span class="fu">:</span> <span class="fu">{</span>
            <span class="dt">"hello"</span><span class="fu">:</span> <span class="st">"hello world"</span><span class="fu">,</span>
            <span class="dt">"query"</span><span class="fu">:</span> <span class="st">"how are you?"</span><span class="fu">,</span>
            <span class="dt">"interpolate"</span><span class="fu">:</span> <span class="st">"{{what}} is {{how}}"</span>
        <span class="fu">}</span>
    <span class="fu">},</span>
    <span class="dt">"fr"</span><span class="fu">:</span> <span class="fu">{</span>
        <span class="dt">"translation"</span><span class="fu">:</span> <span class="fu">{</span>
            <span class="dt">"hello"</span><span class="fu">:</span> <span class="st">"bonjour le monde"</span><span class="fu">,</span>
            <span class="dt">"query"</span><span class="fu">:</span> <span class="st">"ça va ?"</span><span class="fu">,</span>
            <span class="dt">"interpolate"</span><span class="fu">:</span> <span class="st">"{{what}} est {{how}}"</span>
        <span class="fu">}</span>
    <span class="fu">}</span>
<span class="fu">}</span></code></pre></div>
<p>We can create a translator, setting the default language to English (en) as:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tr &lt;-<span class="st"> </span>traduire<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/traduire/man/i18n.html">i18n</a></span>(path, <span class="st">"en"</span>)
tr
## &lt;i18n&gt;
##   Public:
##     add_resource_bundle: function (language, namespace, resources, deep = FALSE, overwrite = FALSE) 
##     default_namespace: function () 
##     exists: function (string, data = NULL, language = NULL, count = NULL, 
##     has_resource_bundle: function (language, namespace) 
##     initialize: function (resources, language, default_namespace, debug, resource_pattern, 
##     language: function () 
##     languages: function () 
##     load_languages: function (languages) 
##     load_namespaces: function (namespaces) 
##     replace: function (text, ...) 
##     set_default_namespace: function (namespace) 
##     set_language: function (language) 
##     t: function (string, data = NULL, language = NULL, count = NULL, 
##   Private:
##     context: V8, environment</code></pre></div>
<p>With this object we can perform translations with the <code>t</code> method by passing in a key from within our translations:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tr<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="st">"hello"</span>)
## [1] "hello world"</code></pre></div>
<p>Specify the <code>language</code> argument to change language:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tr<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="st">"hello"</span>, <span class="dt">language =</span> <span class="st">"fr"</span>)
## [1] "bonjour le monde"</code></pre></div>
<div id="interpolation" class="section level2">
<h2 class="hasAnchor">
<a href="#interpolation" class="anchor"></a>Interpolation</h2>
<p>String interpolation is done using a syntax very similar to <a href="https://cran.r-project.org/package=glue"><code>glue</code></a> (see the <a href="https://www.i18next.com/translation-function/interpolation"><code>i18next</code> documentation</a>)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tr<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="st">"interpolate"</span>, <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">what =</span> <span class="st">"i18next"</span>, <span class="dt">how =</span> <span class="st">"easy"</span>),
     <span class="dt">language =</span> <span class="st">"en"</span>)
## [1] "i18next is easy"
tr<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="st">"interpolate"</span>, <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">what =</span> <span class="st">"i18next"</span>, <span class="dt">how =</span> <span class="st">"facile"</span>),
     <span class="dt">language =</span> <span class="st">"fr"</span>)
## [1] "i18next est facile"</code></pre></div>
</div>
<div id="pluralisation" class="section level2">
<h2 class="hasAnchor">
<a href="#pluralisation" class="anchor"></a>Pluralisation</h2>
<p>The example here is derived from a <a href="https://github.com/mrc-ide/hintr">web API</a> that we developed the package to support. We wanted to, as a service, validate incoming data and return information back to user about what to fix; if the data is missing one or more columns we will report back the columns that they are missing. This requires different translations for the singular case (“Data missing column X”) and plural (“Data missing <strong>columns</strong> X, Y”).</p>
<p>The translation file looks like:</p>
<div class="sourceCode"><pre class="sourceCode json"><code class="sourceCode json"><span class="fu">{</span>
    <span class="dt">"en"</span><span class="fu">:</span> <span class="fu">{</span>
        <span class="dt">"translation"</span><span class="fu">:</span> <span class="fu">{</span>
            <span class="dt">"nocols"</span><span class="fu">:</span> <span class="st">"Data missing column {{missing}}"</span><span class="fu">,</span>
            <span class="dt">"nocols_plural"</span><span class="fu">:</span> <span class="st">"Data missing columns {{missing}}"</span>
        <span class="fu">}</span>
    <span class="fu">},</span>

    <span class="dt">"fr"</span><span class="fu">:</span> <span class="fu">{</span>
        <span class="dt">"translation"</span><span class="fu">:</span> <span class="fu">{</span>
            <span class="dt">"nocols"</span><span class="fu">:</span> <span class="st">"Les données sont manquantes colonne {{missing}}"</span><span class="fu">,</span>
            <span class="dt">"nocols_plural"</span><span class="fu">:</span> <span class="st">"Les données sont manquantes colonnes {{missing}}"</span>
        <span class="fu">}</span>
    <span class="fu">}</span>
<span class="fu">}</span></code></pre></div>
<p>where the <code>_plural</code> suffix is important for <code>i18next</code> for determining the string to return for a singular or plural case, and the <code>count</code> element determines if the string is singular or plural.</p>
<p>Then we can use this as:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tr &lt;-<span class="st"> </span>traduire<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/traduire/man/i18n.html">i18n</a></span>(path_validation)</code></pre></div>
<p>Pluralisation of results is supported using keys that include <code>_plural</code> suffix (see the <a href="https://www.i18next.com/translation-function/plurals"><code>i18next</code> documentation</a>) and by passing a <code>count</code> argument in to the translation:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tr<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="st">"nocols"</span>, <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">missing =</span> <span class="st">"A"</span>), <span class="dt">count =</span> <span class="dv">1</span>)
## [1] "Data missing column A"
tr<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="st">"nocols"</span>, <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">missing =</span> <span class="st">"A, B"</span>), <span class="dt">count =</span> <span class="dv">2</span>)
## [1] "Data missing columns A, B"</code></pre></div>
<p>or, changing the language:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tr<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="st">"nocols"</span>, <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">missing =</span> <span class="st">"A"</span>), <span class="dt">count =</span> <span class="dv">1</span>, <span class="dt">language =</span> <span class="st">"fr"</span>)
## [1] "Les données sont manquantes colonne A"
tr<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="st">"nocols"</span>, <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">missing =</span> <span class="st">"A, B"</span>), <span class="dt">count =</span> <span class="dv">2</span>, <span class="dt">language =</span> <span class="st">"fr"</span>)
## [1] "Les données sont manquantes colonnes A, B"</code></pre></div>
</div>
<div id="fallback-language" class="section level2">
<h2 class="hasAnchor">
<a href="#fallback-language" class="anchor"></a>Fallback language</h2>
<p>To illustrate this feature, we use a list of translations of <code>Hello world!</code> which includes many languages.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">path_hello &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"hello/inst/traduire.json"</span>, <span class="dt">package =</span> <span class="st">"traduire"</span>)</code></pre></div>
<p>Most simply, if we want to fall back onto a single language for all translations, we can provide a fallback language as a string:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tr &lt;-<span class="st"> </span>traduire<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/traduire/man/i18n.html">i18n</a></span>(path_hello, <span class="dt">fallback =</span> <span class="st">"it"</span>)
tr<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="st">"hello"</span>, <span class="dt">language =</span> <span class="st">"unknown"</span>)
## [1] "Ciao Mondo!"</code></pre></div>
<p>Alternatively, a chain of languages to try can be provided:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tr &lt;-<span class="st"> </span>traduire<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/traduire/man/i18n.html">i18n</a></span>(path_hello, <span class="dt">fallback =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"de"</span>))
tr<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="st">"hello"</span>, <span class="dt">language =</span> <span class="st">"unknown"</span>)
## [1] "Hallo Welt!"</code></pre></div>
<p>If you want to have different fallback languages for different target languages, provide a named list of mappings (each of which can be a scalar or vector of fallback languages as above):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tr &lt;-<span class="st"> </span>traduire<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/traduire/man/i18n.html">i18n</a></span>(path_hello, <span class="dt">fallback =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">co =</span> <span class="st">"fr"</span>, <span class="st">"default"</span> =<span class="st"> "en"</span>))
tr<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="st">"hello"</span>, <span class="dt">language =</span> <span class="st">"co"</span>)
## [1] "Bonjour le Monde!"
tr<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="st">"hello"</span>, <span class="dt">language =</span> <span class="st">"unknown"</span>)
## [1] "Hello World!"</code></pre></div>
</div>
<div id="translating-multiple-keys-in-a-block-of-text" class="section level2">
<h2 class="hasAnchor">
<a href="#translating-multiple-keys-in-a-block-of-text" class="anchor"></a>Translating multiple keys in a block of text</h2>
<p>The motivating use case we had was translating a json file for use in an <a href="http://github.com/mrc-ide/hint">upstream web application</a>, so the text to translate might contain data like:</p>
<div class="sourceCode"><pre class="sourceCode json"><code class="sourceCode json"><span class="fu">{</span>
  <span class="dt">"id"</span><span class="fu">:</span> <span class="st">"area_scope"</span><span class="fu">,</span>
  <span class="dt">"label"</span><span class="fu">:</span> <span class="st">"element_label"</span><span class="fu">,</span>
  <span class="dt">"type"</span><span class="fu">:</span> <span class="st">"multiselect"</span><span class="fu">,</span>
  <span class="dt">"description"</span><span class="fu">:</span> <span class="st">"element_description"</span>
<span class="fu">}</span></code></pre></div>
<p>where the json contains a mix of elements to be internationalised (such as the values of <code>label</code> and <code>description</code>) and elements to be left as-is (such as the values of <code>id</code> and <code>type</code>). The snippet above is a simplified version of the <a href="https://github.com/mrc-ide/naomi/blob/178fc4a955dd37e5bc39783afa68cc02e818ce51/inst/metadata/general_run_options.json">full data</a> where the values to translate might occur at any depth within the json.</p>
<p>To support this, the <code>i18n</code> object has a <code>replace</code> method, which performs string replacement of text wrapped in <code><a href="../reference/translator.html">t_(...)</a></code>. So we rewrite our json:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">string &lt;-<span class="st"> '{</span>
<span class="st">  "id": "area_scope",</span>
<span class="st">  "label": "t_(element_label)",</span>
<span class="st">  "type": "multiselect",</span>
<span class="st">  "description": "t_(element_description)"</span>
<span class="st">}'</span></code></pre></div>
<p>and we provide a set of translations:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">translations &lt;-<span class="st"> '{</span>
<span class="st">    "en": {</span>
<span class="st">        "translation": {</span>
<span class="st">            "element_label": "Country",</span>
<span class="st">            "element_description": "Select your countries"</span>
<span class="st">        }</span>
<span class="st">    },</span>
<span class="st">    "fr": {</span>
<span class="st">        "translation": {</span>
<span class="st">            "element_label": "Payes",</span>
<span class="st">            "element_description": "Sélectionnez vos payes"</span>
<span class="st">        }</span>
<span class="st">    }</span>
<span class="st">}'</span></code></pre></div>
<p>We construct a translator object with these translations:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tr &lt;-<span class="st"> </span>traduire<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/traduire/man/i18n.html">i18n</a></span>(translations)</code></pre></div>
<p>We can then use the <code>replace</code> method to translate all strings (wrapped here in <code>writeLines</code> to make it easier to read with all json quotes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span>(tr<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/replace.html">replace</a></span>(string))
## {
##   "id": "area_scope",
##   "label": "Country",
##   "type": "multiselect",
##   "description": "Select your countries"
## }</code></pre></div>
<p>or, into French:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/writeLines.html">writeLines</a></span>(tr<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/replace.html">replace</a></span>(string, <span class="dt">language =</span> <span class="st">"fr"</span>))
## {
##   "id": "area_scope",
##   "label": "Payes",
##   "type": "multiselect",
##   "description": "Sélectionnez vos payes"
## }</code></pre></div>
<p>Note that while the input text here is json, it could be anything at all, and will not be parsed as json.</p>
</div>
<div id="use-within-a-package" class="section level2">
<h2 class="hasAnchor">
<a href="#use-within-a-package" class="anchor"></a>Use within a package</h2>
<p>We provide an optional workflow for using translations within a package, or some other piece of code where the translations will be fairly invasive to add, allowing you to write essentially:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">traduire<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/traduire/man/translator.html">t_</a></span>(...)</code></pre></div>
<p>and have all the <code>...</code> arguments forwarded to the appropriate translator object. There are several details here:</p>
<ul>
<li>how do we determine what is the “appropriate” translator object</li>
<li>how do we determine what language is active for this translation?</li>
</ul>
<p>To do this, we allow packages (or other similar code) to “register” a translator, like</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">traduire<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/traduire/man/translator.html">translator_register</a></span>(resources)</code></pre></div>
<p>where <code>resources</code> is passed to <code><a href="../reference/i18n.html">traduire::i18n</a></code>.</p>
<p>Here we show a complete example package that implements “hello-world-as-a-service” - i.e., a small web service that will reply with a version of “Hello world!” translated into the client’s choice.</p>
<p>The full package is included as an example within <code>traduire</code> at <code><a href="https://rdrr.io/r/base/system.file.html">system.file("hello", package = "traduire")</a></code> and is</p>
<pre class="plain"><code>hello
|-+= R
| |--= api.R
| \--= hello.R
|-+= inst
| |--= README.md
| |--= plumber.R
| \--= traduire.json
|-+= man
| |--= api.Rd
| \--= hello.Rd
|--= DESCRIPTION
|--= LICENSE
\--= NAMESPACE</code></pre>
<p>Below is the code in <code>hello.R</code>, which can say rough translations of “hello world” in a number of languages:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hello &lt;-<span class="st"> </span><span class="cf">function</span>(...) {
  cowsay<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cowsay/man/say.html">say</a></span>(<span class="st">"Hello"</span>, <span class="st">"cow"</span>, ...)
}

world &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">language =</span> <span class="st">"en"</span>, ...) {
  cowsay<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cowsay/man/say.html">say</a></span>(<span class="kw"><a href="../reference/translator.html">t_</a></span>(<span class="st">"hello"</span>, <span class="dt">language =</span> language), <span class="st">"cow"</span>, ...)
}

monde &lt;-<span class="st"> </span><span class="cf">function</span>(...) {
  cowsay<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/cowsay/man/say.html">say</a></span>(<span class="kw"><a href="../reference/translator.html">t_</a></span>(<span class="st">"hello"</span>), ...)
}

.onLoad &lt;-<span class="st"> </span><span class="cf">function</span>(...) {
  path &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"traduire.json"</span>, <span class="dt">package =</span> <span class="st">"hello"</span>, <span class="dt">mustWork =</span> <span class="ot">TRUE</span>)
  traduire<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/traduire/man/translator.html">translator_register</a></span>(path, <span class="st">"en"</span>)
}</code></pre></div>
<p>Here,</p>
<ul>
<li>
<code>hello</code> is a simple function that does no translation</li>
<li>
<code>world</code> is a function that translates with an explicit language argument, but finds the translations automagically</li>
<li>
<code>monde</code> is a function that translates and finds both the translations and the language automagically</li>
</ul>
<p>The <code>.onLoad</code> function contains a call to <code><a href="../reference/translator.html">traduire::translator_register</a></code> which registers a translator database for the package. All calls to <code>t_</code> that come from this package will use this registered translator.</p>
<p>Why would we want to do this? If we were using <a href="https://www.rplumber.io/">plumber</a> to build an API we might want to allow the requests to come in with a header indicating the language. Our plumber api might look like:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#' @get /</span>
<span class="co">#' @html</span>
<span class="cf">function</span>(res, req) {
  language &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(req<span class="op">$</span>HEADERS)[[<span class="st">"accept-language"</span>]]
  <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(hello<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/hello/man/world.html">world</a></span>(language, <span class="dt">type =</span> <span class="st">"string"</span>), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)
}

<span class="co">#' @get /hello/&lt;animal&gt;</span>
<span class="co">#' @html</span>
<span class="cf">function</span>(res, req, animal) {
  <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(hello<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/hello/man/monde.html">monde</a></span>(<span class="dt">by =</span> animal, <span class="dt">type =</span> <span class="st">"string"</span>), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)
}</code></pre></div>
<p>The first endpoint inspects the endpoint’s <code>req</code> object to get the requested language, but the second gets it automagically. This can be understood by looking at the code used to run the API:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">api &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">port =</span> <span class="dv">8888</span>) {
  path &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"plumber.R"</span>, <span class="dt">package =</span> <span class="st">"hello"</span>, <span class="dt">mustWork =</span> <span class="ot">TRUE</span>)
  pr &lt;-<span class="st"> </span>plumber<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/plumber/man/plumber.html">plumb</a></span>(path)
  pr<span class="op">$</span><span class="kw">registerHook</span>(<span class="st">"preroute"</span>, api_set_language)
  pr<span class="op">$</span><span class="kw">registerHook</span>(<span class="st">"postserialize"</span>, api_reset_language)
  pr<span class="op">$</span><span class="kw">run</span>(<span class="dt">port =</span> port)
}

api_set_language &lt;-<span class="st"> </span><span class="cf">function</span>(data, req, res) {
  <span class="cf">if</span> (<span class="st">"accept-language"</span> <span class="op">%in%</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(req<span class="op">$</span>HEADERS)) {
    language &lt;-<span class="st"> </span>req<span class="op">$</span>HEADERS[[<span class="st">"accept-language"</span>]]
    data<span class="op">$</span>reset_language &lt;-<span class="st"> </span>traduire<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/traduire/man/translator.html">translator_set_language</a></span>(language)
  }
}

api_reset_language &lt;-<span class="st"> </span><span class="cf">function</span>(data, req, res, value) {
  <span class="cf">if</span> (<span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/NULL.html">is.null</a></span>(data<span class="op">$</span>reset_language)) {
    data<span class="op">$</span><span class="kw">reset_language</span>()
  }
  value
}</code></pre></div>
<p>So at the beginning of each api request we are calling <code><a href="../reference/translator.html">traduire::translator_set_language</a></code>, which affects only this package as a <a href="https://www.rplumber.io/docs/programmatic-usage.html#router-hooks">“preroute” hook</a> and resetting this in the “postserialize” hook.</p>
<p>The full package is available at <code><a href="https://rdrr.io/r/base/system.file.html">system.file("hello", package = "traduire")</a></code>. If you run the API, it can be used like:</p>
<pre><code>$ curl -H "Accept-Language: fr" http://localhost:8888

 -----
Salut le monde !
 ------
    \   ^__^
     \  (oo)\ ________
        (__)\         )\ /\
             ||------w|
             ||      ||
$ curl -H "Accept-Language: en" http://localhost:8888

 -----
Hello world!
 ------
    \   ^__^
     \  (oo)\ ________
        (__)\         )\ /\
             ||------w|
             ||      ||

$ curl -H "Accept-Language: ko" http://localhost:8888/hello/cat

 --------------
반갑다 세상아
 --------------
    \
      \
        \
            |\___/|
          ==) ^Y^ (==
            \  ^  /
             )=*=(
            /     \
            |     |
           /| | | |\
           \| | |_|/\
      jgs  //_// ___/
               \_)</code></pre>
</div>
<div id="namespaces-and-the-structure-of-translation-files" class="section level2">
<h2 class="hasAnchor">
<a href="#namespaces-and-the-structure-of-translation-files" class="anchor"></a>Namespaces, and the structure of translation files</h2>
<p>This section outlines how to write the translation (json) files, alongside a discussion of using namespaces. Consider again the first example:</p>
<div class="sourceCode"><pre class="sourceCode json"><code class="sourceCode json"><span class="fu">{</span>
    <span class="dt">"en"</span><span class="fu">:</span> <span class="fu">{</span>
        <span class="dt">"translation"</span><span class="fu">:</span> <span class="fu">{</span>
            <span class="dt">"hello"</span><span class="fu">:</span> <span class="st">"hello world"</span><span class="fu">,</span>
            <span class="dt">"query"</span><span class="fu">:</span> <span class="st">"how are you?"</span><span class="fu">,</span>
            <span class="dt">"interpolate"</span><span class="fu">:</span> <span class="st">"{{what}} is {{how}}"</span>
        <span class="fu">}</span>
    <span class="fu">},</span>
    <span class="dt">"fr"</span><span class="fu">:</span> <span class="fu">{</span>
        <span class="dt">"translation"</span><span class="fu">:</span> <span class="fu">{</span>
            <span class="dt">"hello"</span><span class="fu">:</span> <span class="st">"bonjour le monde"</span><span class="fu">,</span>
            <span class="dt">"query"</span><span class="fu">:</span> <span class="st">"ça va ?"</span><span class="fu">,</span>
            <span class="dt">"interpolate"</span><span class="fu">:</span> <span class="st">"{{what}} est {{how}}"</span>
        <span class="fu">}</span>
    <span class="fu">}</span>
<span class="fu">}</span></code></pre></div>
<p>In this format, the top level keys (<code>en</code>, <code>fr</code>) represent <em>languages</em> and the next level key (<code>translation</code>) which appears redundant represents a <a href="https://www.i18next.com/principles/namespaces"><em>namespace</em></a>. A translation set can have multiple namespaces, which can help with organising a large set of strings, and can be used to split the file up over smaller files that might be easier to work with (see below).</p>
<p>Below, we have file with two namespaces, <code>common</code> and <code>login</code>. These might represent strings used throughout the application and in a login component, for example.</p>
<div class="sourceCode"><pre class="sourceCode json"><code class="sourceCode json"><span class="fu">{</span>
    <span class="dt">"en"</span><span class="fu">:</span> <span class="fu">{</span>
        <span class="dt">"common"</span><span class="fu">:</span> <span class="fu">{</span>
            <span class="dt">"hello"</span><span class="fu">:</span> <span class="st">"hello world"</span>
        <span class="fu">},</span>
        <span class="dt">"login"</span><span class="fu">:</span> <span class="fu">{</span>
            <span class="dt">"username"</span><span class="fu">:</span> <span class="st">"Username"</span><span class="fu">,</span>
            <span class="dt">"password"</span><span class="fu">:</span> <span class="st">"Password"</span>
        <span class="fu">}</span>
    <span class="fu">},</span>
    <span class="dt">"fr"</span><span class="fu">:</span> <span class="fu">{</span>
        <span class="dt">"common"</span><span class="fu">:</span> <span class="fu">{</span>
            <span class="dt">"hello"</span><span class="fu">:</span> <span class="st">"salut le monde"</span>
        <span class="fu">},</span>
        <span class="dt">"login"</span><span class="fu">:</span> <span class="fu">{</span>
            <span class="dt">"username"</span><span class="fu">:</span> <span class="st">"Nom d'utilisateur"</span><span class="fu">,</span>
            <span class="dt">"password"</span><span class="fu">:</span> <span class="st">"Mot de passe"</span>
        <span class="fu">}</span>
    <span class="fu">}</span>
<span class="fu">}</span></code></pre></div>
<p>When constructing the translator object we can provide a default namespace (it defaults to <code>translation</code>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tr &lt;-<span class="st"> </span>traduire<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/traduire/man/i18n.html">i18n</a></span>(path, <span class="dt">default_namespace =</span> <span class="st">"common"</span>)</code></pre></div>
<p>Keys that are provided without an explicit namespace, will be looked up in the default namespace:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tr<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="st">"hello"</span>)
## [1] "hello world"</code></pre></div>
<p>or provide a namespace when looking up keys:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tr<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="st">"common:hello"</span>, <span class="dt">language =</span> <span class="st">"fr"</span>)
## [1] "salut le monde"
tr<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="st">"login:username"</span>, <span class="dt">language =</span> <span class="st">"fr"</span>)
## [1] "Nom d'utilisateur"</code></pre></div>
<p>So far, this brings relatively little advantage as our file, while structured, is still going to end up really large as all the files end up in it. So we might want to break it up like so:</p>
<pre class="plain"><code>structured
|--= en-common.json
|--= en-login.json
|--= fr-common.json
\--= fr-login.json</code></pre>
<p>where each file is orgnanised like:</p>
<div class="sourceCode"><pre class="sourceCode json"><code class="sourceCode json"><span class="fu">{</span>
    <span class="dt">"username"</span><span class="fu">:</span> <span class="st">"Username"</span><span class="fu">,</span>
    <span class="dt">"password"</span><span class="fu">:</span> <span class="st">"Password"</span>
<span class="fu">}</span></code></pre></div>
<p>to allow this, we need to load the files one by one into the translation object, rather than as a single resource bundle. To do this, we can use the <code>add_resource_bundle</code> method:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">obj &lt;-<span class="st"> </span>traduire<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/traduire/man/i18n.html">i18n</a></span>(<span class="ot">NULL</span>)
obj<span class="op">$</span><span class="kw">add_resource_bundle</span>(<span class="st">"en"</span>, <span class="st">"common"</span>, <span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(path, <span class="st">"en-common.json"</span>))
obj<span class="op">$</span><span class="kw">add_resource_bundle</span>(<span class="st">"en"</span>, <span class="st">"login"</span>, <span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(path, <span class="st">"en-login.json"</span>))
obj<span class="op">$</span><span class="kw">add_resource_bundle</span>(<span class="st">"fr"</span>, <span class="st">"common"</span>, <span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(path, <span class="st">"fr-common.json"</span>))
obj<span class="op">$</span><span class="kw">add_resource_bundle</span>(<span class="st">"fr"</span>, <span class="st">"login"</span>, <span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(path, <span class="st">"fr-login.json"</span>))
obj<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="st">"login:password"</span>, <span class="dt">language =</span> <span class="st">"fr"</span>)
## [1] "Mot de passe"</code></pre></div>
<p>This is clearly going to be error prone to do with a large number of translation files, though a loop could help:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">obj &lt;-<span class="st"> </span>traduire<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/traduire/man/i18n.html">i18n</a></span>(<span class="ot">NULL</span>)
<span class="cf">for</span> (language <span class="cf">in</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"en"</span>, <span class="st">"fr"</span>)) {
  <span class="cf">for</span> (namespace <span class="cf">in</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"common"</span>, <span class="st">"login"</span>)) {
    bundle &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(path, <span class="kw"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"%s-%s.json"</span>, language, namespace))
    obj<span class="op">$</span><span class="kw">add_resource_bundle</span>(language, namespace, bundle)
  }
}
obj<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="st">"login:password"</span>, <span class="dt">language =</span> <span class="st">"fr"</span>)
## [1] "Mot de passe"</code></pre></div>
<p>An alternative is to pass in the pattern used to locate these files, though this approach works best if you also declare your namespaces and languages up front. The pattern uses glue’s syntax, and the pattern must include placeholders <code>language</code> and <code>namespace</code> (and no others):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pattern &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(path, <span class="st">"{language}-{namespace}.json"</span>)
obj &lt;-<span class="st"> </span>traduire<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/traduire/man/i18n.html">i18n</a></span>(<span class="ot">NULL</span>, <span class="dt">resource_pattern =</span> pattern,
                      <span class="dt">languages =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"en"</span>, <span class="st">"fr"</span>),
                      <span class="dt">namespaces =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"common"</span>, <span class="st">"login"</span>))
obj<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/base/t.html">t</a></span>(<span class="st">"login:password"</span>, <span class="dt">language =</span> <span class="st">"fr"</span>)
## [1] "Mot de passe"</code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#interpolation">Interpolation</a></li>
      <li><a href="#pluralisation">Pluralisation</a></li>
      <li><a href="#fallback-language">Fallback language</a></li>
      <li><a href="#translating-multiple-keys-in-a-block-of-text">Translating multiple keys in a block of text</a></li>
      <li><a href="#use-within-a-package">Use within a package</a></li>
      <li><a href="#namespaces-and-the-structure-of-translation-files">Namespaces, and the structure of translation files</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Rich FitzJohn.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
